# Обзор проекта service_print_check:
---
## Технологии: 

| Название                         | Версия   |
| -------------------------------- | -------- |
| Go                               | 1.20.4   |
| github.com/gorilla/websocket     | 1.5.1    |
| github.com/rs/cors               | 1.9.0    |

---
## Детали проекта:
---
### Подробное описание папок проекта:

```
C:\Users\Enduro\Documents\latypova\kassa\service_print_check
├── consttypes - содержит константные типы и определения, используемые в проекте
├── fptr - предоставляет интерфейс для взаимодействия с фискальными принтерами с использованием библиотеки Fptr10
├── packetlog - обрабатывает операции логирования, включая инициализацию и запись логов в файлы
└── resource - хранит ресурсы, такие как иконки и манифесты, используемые для сборки приложения
```

---
### Полная бизнес-логика:
- Проект представляет собой сервис, предназначенный для печати чеков из данных JSON, полученных через WebSocket соединение.
- Он использует библиотеку Fptr10 для связи с фискальными принтерами Atol.
- Сервис поддерживает печать чеков, закрытие смен и печать X-отчетов.
- Он обрабатывает WebSocket соединения, парсит данные JSON и взаимодействует с драйвером фискального принтера для выполнения команд.
- Сервис включает функциональность логирования для записи действий программы и ошибок.

---
### Управление зависимостями:
- Проект использует модули Go для управления зависимостями.
- Зависимости указаны в файле `go.mod`.
- Команда `go get` используется для загрузки и установки зависимостей.

---
### Примечания:
- Проект настроен на работу на порту 8081.
- Он позволяет WebSocket соединения с любого источника.
- Сервис может работать в режиме эмуляции, который симулирует взаимодействие с фискальным принтером.
- Уровень логирования можно настроить с помощью флага `-debug`.

---
## Все конечные точки/Все события, которые проект обрабатывает и слушает:

### WebSockets
- ws://localhost:8081/ws - Двунаправленный канал связи для получения запросов на печать и отправки ответов.
    - printCheck - Запрос на печать чека на основе предоставленных данных JSON.
    - closeShift - Запрос на закрытие текущей смены с указанным именем кассира.
    - xReport - Запрос на печать X-отчета.

---
## Все downstream сервисы

- Фискальный принтер Atol - Сервис полагается на фискальный принтер Atol для физической печати чеков и отчетов.

---
## Все upstream сервисы

- Любая система, способная отправлять WebSocket запросы с данными JSON - Это может быть веб-приложение, система точек продаж или любая другая система, которая нуждается в печати чеков.

---
## Тестирование
- Зависимости: В предоставленных файлах не указаны конкретные зависимости для тестирования.
- Резюме найденных тестовых потоков: В коде не определены явные тестовые потоки.
- Хранилища фикстур: Механизмы хранения фикстур не очевидны.
- Полезно знать: Тестирование, вероятно, будет включать симуляцию WebSocket запросов и проверку взаимодействия с библиотекой Fptr10, возможно, с использованием моков или заглушек.

---
## Развертывание
- Резюме: Проект может быть собран в исполняемый файл с помощью команды `go build`. Исполняемый файл затем может быть развернут на сервере и запущен как фоновый процесс.

---
## Настройка среды разработки

1. **Установите Go:** Скачайте и установите язык программирования Go с официального сайта: https://golang.org/
2. **Настройте модули Go:** Убедитесь, что модули Go включены, установив переменную окружения `GO111MODULE` в `on`.
3. **Установите зависимости:** Перейдите в каталог проекта и выполните команду `go get` для загрузки и установки необходимых зависимостей.

---
## Запуск проекта в среде разработки

### Инструкции по выполнению

- **Локальный режим**:
```shell
go run jsontokkt.go
```
Эта команда скомпилирует и запустит проект в локальном режиме, прослушивая WebSocket соединения на порту 8081.

---
## Диаграммы последовательности для каждого API/события с деталями всех downstream зависимостей и данных:

- Событие: Запрос на печать чека
```sequence
Клиент->service_print_check: printCheck({"tableData": [...], "employee": "...", "master": "..."})
service_print_check->Библиотека Fptr10: connectWithKassa(comport, ipaddresskkt, portkktatol, ipaddressservrkkt)
Библиотека Fptr10->Фискальный принтер Atol: Подключение
service_print_check->Библиотека Fptr10: checkOpenShift(openShiftIfClose, kassir)
Библиотека Fptr10->Фискальный принтер Atol: Получение статуса
service_print_check->Библиотека Fptr10: sendComandeAndGetAnswerFromKKT(checkJSON)
Библиотека Fptr10->Фискальный принтер Atol: Печать чека
service_print_check->Клиент: printCheckResponse("Чек успешно напечатан")
```
- Событие: Запрос на закрытие смены
```sequence
Клиент->service_print_check: closeShift({"cashier": "..."})
service_print_check->Библиотека Fptr10: connectWithKassa(comport, ipaddresskkt, portkktatol, ipaddressservrkkt)
Библиотека Fptr10->Фискальный принтер Atol: Подключение
service_print_check->Библиотека Fptr10: sendComandeAndGetAnswerFromKKT(closeShiftJSON)
Библиотека Fptr10->Фискальный принтер Atol: Закрытие смены
service_print_check->Клиент: printCheckResponse("Смена успешно закрыта")
```
- Событие: Запрос на печать X-отчета
```sequence
Клиент->service_print_check: xReport()
service_print_check->Библиотека Fptr10: connectWithKassa(comport, ipaddresskkt, portkktatol, ipaddressservrkkt)
Библиотека Fptr10->Фискальный принтер Atol: Подключение
service_print_check->Библиотека Fptr10: sendComandeAndGetAnswerFromKKT(xReportJSON)
Библиотека Fptr10->Фискальный принтер Atol: Печать X-отчета
service_print_check->Клиент: printCheckResponse("X-отчет успешно напечатан")
```

---
